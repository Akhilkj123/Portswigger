- Consider a shopping application which has a "Check stock" feature that parses XML input and returns any unexpected values in the response.

![image](https://github.com/Akhilkj123/Portswigger/assets/65653010/a173cbd6-43be-482f-b1e9-d9b9b0d0ea18)

- This application server is running a (simulated) EC2 metadata endpoint at the default URL, which is http://169.254.169.254/.Now using BurpSuite we intrude the traffic when checkstock is being selected

![image](https://github.com/Akhilkj123/Portswigger/assets/65653010/64702628-a1e4-451a-a000-dec47672ab82)

- We exploit the XXE vulnerability to perform an SSRF attack that obtains the server's IAM secret access key from the EC2 metadata endpoint. We insert the following external entity definition in between the XML declaration and the stockCheck element. We replaced the productId number with a reference to the external entity

![image](https://github.com/Akhilkj123/Portswigger/assets/65653010/f54ff829-d2c4-463a-8c2a-db319c2cd247)

- We updated the URL in the DTD to explore the API until we reach /latest/meta-data/iam/security-credentials/admin. It returned JSON containing the SecretAccessKey. Thus the lab gets solved.

![image](https://github.com/Akhilkj123/Portswigger/assets/65653010/94088278-0077-4a5e-ba98-68b640bc2011)







